<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>我是登录页</title>
    <link
      rel="stylesheet"
      href="//at.alicdn.com/t/font_1224930_ax1s5lfwhs9.css"
    />
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="com-wrp login-wrp">
        <div class="title">价值 500w 的管理系统</div>
        <div class="item">
          <span class="label">用户名</span>
          <div class="inp"><input type="text" id="js_account" /></div>
        </div>
        <div class="item">
          <span class="label">密码</span>
          <div class="inp"><input type="password" id="js_pwd" /></div>
        </div>
        <div class="item btn-wrp">
          <button class="btn" type="button" id="js_submit">
            <i class="iconfont icon-enter"></i> 快点我
          </button>
        </div>
      </div>
    </div>

    <!-- tips -->
    <div id="js_toast" class="toast-wrp" style="display: none;">
      <div class="tips">登录中，稍等...</div>
    </div>

    <script src="./js/jquery.3.4.0.min.js"></script>
    <script>
      $(document).ajaxSuccess(function(event, xhr, setting) {
        if (xhr.status == 200 && xhr.responseJSON) {
          var statusCode = xhr.responseJSON.code || xhr.responseJSON.result.code
          var resutMsg = xhr.responseJSON.msg || xhr.responseJSON.result.msg
          if (statusCode != 1) {
            $('#js_toast').hide()
            alert('出问题了：' + resutMsg)
          }
          if (statusCode == 401) {
            location.href = './login.html'
            return
          }
        }
      })

      // keyup
      $('#js_pwd').keypress(function(e) {
        if (e.keyCode === 13) {
          $('#js_submit').trigger('click')
        }
      })

      $('#js_submit').click(function() {
        var account = $.trim($('#js_account').val())
        var pwd = $.trim($('#js_pwd').val())

        if (!/^[a-zA-Z]+$/.test(account)) {
          alert('狗子，是不是打错内容了')
          return
        }

        if (account && pwd) {
          var subData = JSON.stringify({
            account: account,
            pwd: pwd
          })

          $.ajax({
            url: '/rest/common/login',
            type: 'POST',
            contentType: 'application/json;charset=UTF-8',
            data: subData,
            beforeSend: function(xhr) {
              $('#js_toast').show()
            }
          })
            .then(function(data) {
              if (data.result.code == 1) {
                setTimeout(function() {
                  $('#js_toast').hide()
                  location.href = './list.html'
                }, 1500)
              }
            })
            .catch(function(ins, err, msg) {})
        } else {
          alert('狗子，倒是写点东西啊')
        }
      })
    </script>
  </body>
</html>
